# .github/workflows/publish.yml
name: publish to npmjs
on:
  push:
    tags:
      - 'v*.*.*'
jobs:
  publish:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - name: â¬‡ï¸ Code Checkout
        uses: actions/checkout@v4

      - name: âœ… Validate SemVer Tag
        run: |
          TAG=${GITHUB_REF#refs/tags/}
          echo "Tag: $TAG"
          npx -y -p semver node -e "const semver=require('semver'); const tag=process.argv[1]; const v=tag.replace(/^v/, ''); if(!semver.valid(v)){console.error('Tag '+tag+' is not a valid SemVer'); process.exit(1);} console.log('Valid semver: '+v);" "$TAG"

      - name: ğŸ› ï¸ Node setup & npmrc with OIDC
        uses: actions/setup-node@v4
        with:
          node-version: 24
          registry-url: 'https://registry.npmjs.org'

      - name: ğŸ“¦ Install
        run: npm ci

      - name: âš™ï¸ Build
        run: npm run build

      - name: ğŸš€ Publish
        run: npm publish --access public
